!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t,r,n,i,o,a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function c(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{s(n.next(e))}catch(e){o(e)}}function c(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}s((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}if(null!=(o="11"===(null===(i=null===(n=null===(r=null===(t=/msie|trident/i.test(window.navigator.userAgent)?window.navigator.userAgent:null)||void 0===t?void 0:t.match(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i))||void 0===r?void 0:r[1])||void 0===n?void 0:n.split("."))||void 0===i?void 0:i[0]))&&o){var u=window;u.msCrypto?u.crypto=u.msCrypto:console.error("BindID fatat error; Browser doesn'nt support crypto")}var l,p,f,d;function h(e,t,r,n,i,o,a){try{var c=e[o](a),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,i)}function y(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){h(o,n,i,a,c,"next",e)}function c(e){h(o,n,i,a,c,"throw",e)}a(void 0)}))}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&b(e.prototype,t),r&&b(e,r),e}!function(e){e[e.SdkNotInitialized=0]="SdkNotInitialized",e[e.InvalidConfig=1]="InvalidConfig",e[e.InvalidResponse=2]="InvalidResponse",e[e.AccessDenied=3]="AccessDenied",e[e.ServerError=4]="ServerError",e[e.UserCanceled=5]="UserCanceled",e[e.PlatformError=6]="PlatformError",e[e.InternetConnection=7]="InternetConnection"}(l||(l={})),function(e){e[e.UseLatest=0]="UseLatest",e[e.ApiLevel1=1]="ApiLevel1"}(p||(p={})),function(e){e[e.OpenId=0]="OpenId",e[e.Email=1]="Email",e[e.Phone=2]="Phone",e[e.NetworkInfo=3]="NetworkInfo"}(f||(f={})),function(e){e[e.Phone=0]="Phone",e[e.Email=1]="Email"}(d||(d={}));var w=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(t){var r=function(t){var r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new A(n||[]);return o._invoke=function(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return x()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var c=E(a,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===p)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}(e,r,a),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p={};function f(){}function d(){}function h(){}var y={};y[o]=function(){return this};var v=Object.getPrototypeOf,b=v&&v(v(P([])));b&&b!==r&&n.call(b,o)&&(y=b);var m=h.prototype=f.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function g(t,r){var i;this._invoke=function(o,a){function c(){return new r((function(i,c){!function i(o,a,c,s){var u=l(t[o],t,a);if("throw"!==u.type){var p=u.arg,f=p.value;return f&&"object"===e(f)&&n.call(f,"__await")?r.resolve(f.__await).then((function(e){i("next",e,c,s)}),(function(e){i("throw",e,c,s)})):r.resolve(f).then((function(e){p.value=e,c(p)}),(function(e){return i("throw",e,c,s)}))}s(u.arg)}(o,a,i,c)}))}return i=i?i.then(c,c):c()}}function E(e,t){var r=e.iterator[t.method];if(void 0===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,E(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=l(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function P(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return d.prototype=m.constructor=h,h.constructor=d,d.displayName=s(h,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,s(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e},t.awrap=function(e){return{__await:e}},w(g.prototype),g.prototype[a]=function(){return this},t.AsyncIterator=g,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new g(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(m),s(m,c,"Generator"),m[o]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=P,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),s=n.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),k(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;k(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:P(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}(t.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}}));function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}function A(t,r){return!r||"object"!==e(r)&&"function"!=typeof r?E(t):r}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function O(e,t,r){return(O=x()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&S(i,r.prototype),i}).apply(null,arguments)}function _(e){var t="function"==typeof Map?new Map:void 0;return(_=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return O(e,arguments,P(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),S(n,e)})(e)}function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=P(e);if(t){var i=P(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return A(this,r)}}var j=function(e){k(r,e);var t=C(r);function r(e){var n;return v(this,r),(n=t.call(this,e)).code=r.code,n.name=n.constructor.name,Error.captureStackTrace&&Error.captureStackTrace(E(n),n.constructor),n}return r}(_(Error));j.code="ERR_JOSE_GENERIC";var H=function(e){k(r,e);var t=C(r);function r(){var e;return v(this,r),(e=t.apply(this,arguments)).code=r.code,e}return r}(j);H.code="ERR_JOSE_NOT_SUPPORTED";var K=function(e){k(r,e);var t=C(r);function r(){var e;return v(this,r),(e=t.apply(this,arguments)).code=r.code,e}return r}(j);K.code="ERR_JWE_INVALID";var I=new Map([["A128CBC-HS256",128],["A128GCM",96],["A128GCMKW",96],["A192CBC-HS384",128],["A192GCM",96],["A192GCMKW",96],["A256CBC-HS512",128],["A256GCM",96],["A256GCMKW",96]]),R=function(e){return function(t){var r=I.get(t);if(!r)throw new H("Unsupported JWE Algorithm: ".concat(t));return e(new Uint8Array(r>>3))}},U=new TextEncoder,B=new TextDecoder,T=Math.pow(2,32);function W(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.reduce((function(e,t){return e+t.length}),0),i=new Uint8Array(n),o=0;return t.forEach((function(e){i.set(e,o),o+=e.length})),i}function D(e,t){return W(U.encode(e),new Uint8Array([0]),t)}function M(e,t,r){if(t<0||t>=T)throw new RangeError("value must be >= 0 and <= ".concat(T-1,". Received ").concat(t));e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function J(e){var t=Math.floor(e/T),r=e%T,n=new Uint8Array(8);return M(n,t,0),M(n,r,4),n}function L(e){var t=new Uint8Array(4);return M(t,e),t}function N(e){return W(L(e.length),e)}function Q(e,t,r,n){return G.apply(this,arguments)}function G(){return(G=y(w.mark((function e(t,r,n,i){var o,a,c,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=Math.ceil((n>>3)/32),c=1;case 2:if(!(c<=o)){e.next=22;break}if((s=new Uint8Array(4+r.length+i.length)).set(L(c)),s.set(r,4),s.set(i,4+r.length),a){e.next=13;break}return e.next=10,t("sha256",s);case 10:a=e.sent,e.next=19;break;case 13:return e.t0=W,e.t1=a,e.next=17,t("sha256",s);case 17:e.t2=e.sent,a=(0,e.t0)(e.t1,e.t2);case 19:c++,e.next=2;break;case 22:return a=a.slice(0,n>>3),e.abrupt("return",a);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var q=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;throw new Error("unable to locate global object")}(),z=function(e){var t=e;"string"==typeof t&&(t=U.encode(t));for(var r=[],n=0;n<t.length;n+=32768)r.push(String.fromCharCode.apply(null,t.subarray(n,n+32768)));return q.btoa(r.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},F=function(e){var t=e;t instanceof Uint8Array&&(t=B.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return new Uint8Array(q.atob(t).split("").map((function(e){return e.charCodeAt(0)})))}catch(e){throw new TypeError("The input to be decoded is not correctly encoded.")}},V=q.crypto;function X(e){return e instanceof q.CryptoKey}var Y=V.getRandomValues.bind(V),$=function(e,t){if(t.length<<3!==I.get(e))throw new K("Invalid Initialization Vector length")},Z=function(e,t){var r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":if(r=parseInt(e.substr(-3),10),!(t instanceof Uint8Array))throw new TypeError("".concat(e," content encryption requires Uint8Array as key input"));break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.substr(1,3),10);break;default:throw new H("Content Encryption Algorithm ".concat(e," is unsupported either by JOSE or your javascript runtime"))}if(t instanceof Uint8Array){if(t.length<<3!==r)throw new K("Invalid Content Encryption Key length")}else{if(void 0===t.algorithm)throw new TypeError("Invalid Content Encryption Key type");if(t.algorithm.length!==r)throw new K("Invalid Content Encryption Key length")}};function ee(e,t,r,n,i){return te.apply(this,arguments)}function te(){return(te=y(w.mark((function e(t,r,n,i,o){var a,c,s,u,l,p;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=parseInt(t.substr(1,3),10),e.next=3,V.subtle.importKey("raw",n.subarray(a>>3),"AES-CBC",!1,["encrypt"]);case 3:return c=e.sent,e.next=6,V.subtle.importKey("raw",n.subarray(0,a>>3),{hash:{name:"SHA-".concat(a<<1)},name:"HMAC"},!1,["sign"]);case 6:return s=e.sent,e.t0=Uint8Array,e.next=10,V.subtle.encrypt({iv:i,name:"AES-CBC"},c,r);case 10:return e.t1=e.sent,u=new e.t0(e.t1),l=W(o,i,u,J(o.length<<3)),e.t2=Uint8Array,e.next=16,V.subtle.sign("HMAC",s,l);case 16:return e.t3=e.sent.slice(0,a>>3),p=new e.t2(e.t3),e.abrupt("return",{ciphertext:u,tag:p});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t,r,n){return ne.apply(this,arguments)}function ne(){return(ne=y(w.mark((function e(t,r,n,i){var o,a,c,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r instanceof Uint8Array)){e.next=6;break}return e.next=3,V.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=r;case 7:return o=e.t0,e.t1=Uint8Array,e.next=11,V.subtle.encrypt({additionalData:i,iv:n,name:"AES-GCM",tagLength:128},o,t);case 11:return e.t2=e.sent,a=new e.t1(e.t2),c=a.slice(-16),s=a.slice(0,-16),e.abrupt("return",{ciphertext:s,tag:c});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(){var e=y(w.mark((function e(t,r,n,i,o){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X(n)||n instanceof Uint8Array){e.next=2;break}throw new TypeError("invalid key input");case 2:if(Z(t,n),$(t,i),"CBC"!==t.substr(4,3)){e.next=6;break}return e.abrupt("return",ee(t,r,n,i,o));case 6:return e.abrupt("return",re(r,n,i,o));case 7:case"end":return e.stop()}}),e)})));return function(t,r,n,i,o){return e.apply(this,arguments)}}(),oe=function(){var e=y(w.mark((function e(){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime.');case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function ae(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var ce=new Map([["A128CBC-HS256",256],["A128GCM",128],["A192CBC-HS384",384],["A192GCM",192],["A256CBC-HS512",512],["A256GCM",256]]);function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ue(e){return function(e){if(Array.isArray(e))return se(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return se(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?se(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var le=[{hash:{name:"SHA-256"},name:"HMAC"},!0,["sign"]];function pe(e,t){if(e.algorithm.length!==parseInt(t.substr(1,3),10))throw new TypeError("invalid key size for alg: ".concat(t))}function fe(e,t){if(X(e))return e;if(e instanceof Uint8Array)return V.subtle.importKey("raw",e,"AES-KW",!0,[t]);throw new TypeError("invalid key input")}var de=function(){var e=y(w.mark((function e(t,r,n){var i,o,a;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe(r,"wrapKey");case 2:return pe(o=e.sent,t),e.next=6,(i=V.subtle).importKey.apply(i,["raw",n].concat(ue(le)));case 6:return a=e.sent,e.t0=Uint8Array,e.next=10,V.subtle.wrapKey("raw",a,o,"AES-KW");case 10:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),he=function(){var e=y(w.mark((function e(t,r){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="SHA-".concat(t.substr(-3)),e.t0=Uint8Array,e.next=4,V.subtle.digest(n,r);case 4:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),ye=function(){var e=y(w.mark((function e(t,r,n,i){var o,a,c,s,u=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=u.length>4&&void 0!==u[4]?u[4]:new Uint8Array(0),a=u.length>5&&void 0!==u[5]?u[5]:new Uint8Array(0),X(t)){e.next=4;break}throw new TypeError("invalid key input");case 4:if(X(r)){e.next=6;break}throw new TypeError("invalid key input");case 6:if(c=W(N(U.encode(n)),N(o),N(a),L(i)),r.usages.includes("deriveBits")){e.next=9;break}throw new TypeError('ECDH-ES private key "usages" must include "deriveBits"');case 9:return e.t0=Uint8Array,e.next=12,V.subtle.deriveBits({name:"ECDH",public:t},r,Math.ceil(parseInt(r.algorithm.namedCurve.substr(-3),10)/8)<<3);case 12:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",Q(he,s,i,c));case 15:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),ve=function(){var e=y(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X(t)){e.next=2;break}throw new TypeError("invalid key input");case 2:return e.next=4,V.subtle.generateKey({name:"ECDH",namedCurve:t.algorithm.namedCurve},!0,["deriveBits"]);case 4:return e.abrupt("return",e.sent.privateKey);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(e){if(!X(e))throw new TypeError("invalid key input");return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)};function me(e){if(!(e instanceof Uint8Array)||e.length<8)throw new K("PBES2 Salt Input must be 8 or more octets")}function we(e){if(e instanceof Uint8Array)return V.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(X(e))return e;throw new TypeError("invalid key input")}var ge=function(){var e=y(w.mark((function e(t,r,n){var i,o,a,c,s,u,l,p,f,d=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=d.length>3&&void 0!==d[3]?d[3]:Math.floor(2049*Math.random())+2048,me(o=d.length>4&&void 0!==d[4]?d[4]:Y(new Uint8Array(16))),a=D(t,o),c=parseInt(t.substr(13,3),10),s={hash:{name:"SHA-".concat(t.substr(8,3))},iterations:i,name:"PBKDF2",salt:a},u={length:c,name:"AES-KW"},e.next=9,we(r);case 9:if(!(l=e.sent).usages.includes("deriveBits")){e.next=18;break}return e.t0=Uint8Array,e.next=14,V.subtle.deriveBits(s,l,c);case 14:e.t1=e.sent,p=new e.t0(e.t1),e.next=25;break;case 18:if(!l.usages.includes("deriveKey")){e.next=24;break}return e.next=21,V.subtle.deriveKey(s,l,u,!1,["wrapKey"]);case 21:p=e.sent,e.next=25;break;case 24:throw new TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"');case 25:return e.next=27,de(t.substr(-6),p,n);case 27:return f=e.sent,e.abrupt("return",{encryptedKey:f,p2c:i,p2s:z(o)});case 29:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();function Ee(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new H("alg ".concat(e," is unsupported either by JOSE or your javascript runtime"))}}var Se=function(e,t){if(e.startsWith("HS")){var r=parseInt(e.substr(-3),10),n=t.algorithm.length;if("number"!=typeof n||n<r)throw new TypeError("".concat(e," requires symmetric keys to be ").concat(r," bits or larger"))}if(e.startsWith("RS")||e.startsWith("PS")){var i=t.algorithm.modulusLength;if("number"!=typeof i||i<2048)throw new TypeError("".concat(e," requires key modulusLength to be 2048 bits or larger"))}},ke=function(){var e=y(w.mark((function e(t,r,n){var i,o;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X(r)){e.next=2;break}throw new TypeError("invalid key input");case 2:if(Se(t,r),!r.usages.includes("encrypt")){e.next=9;break}return e.t0=Uint8Array,e.next=7,V.subtle.encrypt(Ee(t),r,n);case 7:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 9:if(!r.usages.includes("wrapKey")){e.next=18;break}return e.next=12,(i=V.subtle).importKey.apply(i,["raw",n].concat(ue(le)));case 12:return o=e.sent,e.t2=Uint8Array,e.next=16,V.subtle.wrapKey("raw",o,r,Ee(t));case 16:return e.t3=e.sent,e.abrupt("return",new e.t2(e.t3));case 18:throw new TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation');case 19:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Ae=R(Y),Pe=function(){var e=y(w.mark((function e(t,r,n,i){var o,a,c,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.substr(0,7),i||(i=Ae(o)),e.next=4,ie(o,n,r,i,new Uint8Array(0));case 4:return a=e.sent,c=a.ciphertext,s=a.tag,e.abrupt("return",{encryptedKey:c,iv:z(i),tag:z(s)});case 8:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),xe=function(){var e=y(w.mark((function e(t){var r,n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(X(t)){e.next=2;break}throw new TypeError("invalid key input");case 2:if(t.extractable){e.next=4;break}throw new TypeError("non-extractable key cannot be extracted as a JWK");case 4:return e.next=6,V.subtle.exportKey("jwk",t);case 6:return r=e.sent,r.ext,r.key_ops,r.alg,r.use,n=ae(r,["ext","key_ops","alg","use"]),e.abrupt("return",n);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Oe(e){return _e.apply(this,arguments)}function _e(){return(_e=y(w.mark((function e(t){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Uint8Array)){e.next=2;break}return e.abrupt("return",{kty:"oct",k:z(t)});case 2:return e.abrupt("return",xe(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ce=function(e){return function(t){var r=ce.get(t);if(!r)throw new H("Unsupported JWE Algorithm: ".concat(t));return e(new Uint8Array(r>>3))}}(Y);function je(e,t,r,n){return He.apply(this,arguments)}function He(){return(He=y(w.mark((function e(t,r,n,i){var o,a,c,s,u,l,p,f,d,h,y,v,b,m,g,E,S,k,A,P=arguments;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=P.length>4&&void 0!==P[4]?P[4]:{},e.t0=t,e.next="dir"===e.t0?4:"ECDH-ES"===e.t0||"ECDH-ES+A128KW"===e.t0||"ECDH-ES+A192KW"===e.t0||"ECDH-ES+A256KW"===e.t0?6:"RSA1_5"===e.t0||"RSA-OAEP"===e.t0||"RSA-OAEP-256"===e.t0||"RSA-OAEP-384"===e.t0||"RSA-OAEP-512"===e.t0?37:"PBES2-HS256+A128KW"===e.t0||"PBES2-HS384+A192KW"===e.t0||"PBES2-HS512+A256KW"===e.t0?42:"A128KW"===e.t0||"A192KW"===e.t0||"A256KW"===e.t0?51:"A128GCMKW"===e.t0||"A192GCMKW"===e.t0||"A256GCMKW"===e.t0?56:65;break;case 4:return s=n,e.abrupt("break",66);case 6:if(be(n)){e.next=8;break}throw new H("ECDH-ES with the provided key is not allowed or not supported by your javascript runtime");case 8:if(u=o.apu,l=o.apv,p=o.epk,e.t1=p,e.t1){e.next=15;break}return e.next=14,ve(n);case 14:p=e.sent;case 15:return e.next=17,Oe(p);case 17:return f=e.sent,d=f.x,h=f.y,y=f.crv,v=f.kty,e.next=24,ye(n,p,"ECDH-ES"===t?r:t,parseInt(t.substr(-5,3),10)||ce.get(r),u,l);case 24:if(b=e.sent,c={epk:{x:d,y:h,crv:y,kty:v}},u&&(c.apu=z(u)),l&&(c.apv=z(l)),"ECDH-ES"!==t){e.next=31;break}return s=b,e.abrupt("break",66);case 31:return s=i||Ce(r),m=t.substr(-6),e.next=35,de(m,b,s);case 35:return a=e.sent,e.abrupt("break",66);case 37:return s=i||Ce(r),e.next=40,ke(t,n,s);case 40:return a=e.sent,e.abrupt("break",66);case 42:return s=i||Ce(r),g=o.p2c,E=o.p2s,e.next=46,ge(t,n,s,g,E);case 46:return S=e.sent,a=S.encryptedKey,c=ae(S,["encryptedKey"]),e.abrupt("break",66);case 51:return s=i||Ce(r),e.next=54,de(t,n,s);case 54:return a=e.sent,e.abrupt("break",66);case 56:return s=i||Ce(r),k=o.iv,e.next=60,Pe(t,n,s,k);case 60:return A=e.sent,a=A.encryptedKey,c=ae(A,["encryptedKey"]),e.abrupt("break",66);case 65:throw new H('unsupported or invalid "alg" (JWE Algorithm) header value');case 66:return e.abrupt("return",{cek:s,encryptedKey:a,parameters:c});case 67:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ie(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ie(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw o}}}}function Ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Re=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=t.filter(Boolean);if(0===i.length||1===i.length)return!0;var o,a=Ke(i);try{for(a.s();!(o=a.n()).done;){var c=o.value,s=Object.keys(c);if(n&&0!==n.size)for(var u=0,l=s;u<l.length;u++){var p=l[u];if(n.has(p))return!1;n.add(p)}else n=new Set(s)}}catch(e){a.e(e)}finally{a.f()}return!0};function Ue(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Be(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Be(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw o}}}}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function We(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var De=R(Y),Me=function(e,t,r,n,i){if(void 0!==i.crit&&void 0===n.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some((function(e){return"string"!=typeof e||0===e.length})))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');var o;o=void 0!==r?new Map([].concat(ue(Object.entries(r)),ue(t.entries()))):t;var a,c=Ue(n.crit);try{for(c.s();!(a=c.n()).done;){var s=a.value;if(!o.has(s))throw new H('Extension Header Parameter "'.concat(s,'" is not recognized'));if(void 0===i[s])throw new e('Extension Header Parameter "'.concat(s,'" is missing'));if(o.get(s)&&void 0===n[s])throw new e('Extension Header Parameter "'.concat(s,'" MUST be integrity protected'))}}catch(e){c.e(e)}finally{c.f()}return new Set(n.crit)}.bind(void 0,K,new Map),Je=function(){function e(t){v(this,e),this._plaintext=t}var t;return m(e,[{key:"setKeyManagementParameters",value:function(e){if(this._keyManagementParameters)throw new TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}},{key:"setProtectedHeader",value:function(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}},{key:"setSharedUnprotectedHeader",value:function(e){if(this._sharedUnprotectedHeader)throw new TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}},{key:"setUnprotectedHeader",value:function(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}},{key:"setAdditionalAuthenticatedData",value:function(e){return this._aad=e,this}},{key:"setContentEncryptionKey",value:function(e){if(this._cek)throw new TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}},{key:"setInitializationVector",value:function(e){if(this._iv)throw new TypeError("setInitializationVector can only be called once");return this._iv=e,this}},{key:"encrypt",value:(t=y(w.mark((function e(t,r){var n,i,o,a,c,s,u,l,p,f,d,h,y,v,b,m;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._protectedHeader||this._unprotectedHeader||this._sharedUnprotectedHeader){e.next=2;break}throw new K("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");case 2:if(Re(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader)){e.next=4;break}throw new K("JWE Shared Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");case 4:if(n=We(We(We({},this._protectedHeader),this._unprotectedHeader),this._sharedUnprotectedHeader),Me(null==r?void 0:r.crit,this._protectedHeader,n),void 0===n.zip){e.next=11;break}if(this._protectedHeader&&this._protectedHeader.zip){e.next=9;break}throw new K('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');case 9:if("DEF"===n.zip){e.next=11;break}throw new H('unsupported JWE "zip" (Compression Algorithm) Header Parameter value');case 11:if(i=n.alg,o=n.enc,"string"==typeof i&&i){e.next=14;break}throw new K('JWE "alg" (Algorithm) Header Parameter missing or invalid');case 14:if("string"==typeof o&&o){e.next=16;break}throw new K('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');case 16:if("dir"!==i){e.next=21;break}if(!this._cek){e.next=19;break}throw new TypeError("setContentEncryptionKey cannot be called when using Direct Encryption");case 19:e.next=24;break;case 21:if("ECDH-ES"!==i){e.next=24;break}if(!this._cek){e.next=24;break}throw new TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");case 24:return e.next=26,je(i,o,t,this._cek,this._keyManagementParameters);case 26:if(u=e.sent,c=u.cek,a=u.encryptedKey,(s=u.parameters)&&(this._protectedHeader?this._protectedHeader=We(We({},this._protectedHeader),s):this.setProtectedHeader(s)),this._iv||(this._iv=De(o)),p=this._protectedHeader?U.encode(z(JSON.stringify(this._protectedHeader))):U.encode(""),this._aad?(f=z(this._aad),l=W(p,U.encode("."),U.encode(f))):l=p,"DEF"!==n.zip){e.next=45;break}return e.next=37,((null==r?void 0:r.deflateRaw)||oe)(this._plaintext);case 37:return y=e.sent,e.next=40,ie(o,y,c,this._iv,l);case 40:v=e.sent,d=v.ciphertext,h=v.tag,e.next=51;break;case 45:return e.next=48,ie(o,this._plaintext,c,this._iv,l);case 48:b=e.sent,d=b.ciphertext,h=b.tag;case 51:return m={ciphertext:z(d),iv:z(this._iv),tag:z(h)},a&&(m.encrypted_key=z(a)),f&&(m.aad=f),this._protectedHeader&&(m.protected=B.decode(p)),this._sharedUnprotectedHeader&&(m.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(m.header=this._unprotectedHeader),e.abrupt("return",m);case 58:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Le=function(){function e(t){v(this,e),this._flattened=new Je(t)}var t;return m(e,[{key:"setContentEncryptionKey",value:function(e){return this._flattened.setContentEncryptionKey(e),this}},{key:"setInitializationVector",value:function(e){return this._flattened.setInitializationVector(e),this}},{key:"setProtectedHeader",value:function(e){return this._flattened.setProtectedHeader(e),this}},{key:"setKeyManagementParameters",value:function(e){return this._flattened.setKeyManagementParameters(e),this}},{key:"encrypt",value:(t=y(w.mark((function e(t,r){var n;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._flattened.encrypt(t,r);case 2:return n=e.sent,e.abrupt("return",[n.protected,n.encrypted_key,n.iv,n.ciphertext,n.tag].join("."));case 4:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}();function Ne(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ne(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ne(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ge(e){var t,r;switch(e.kty){case"oct":switch(e.alg){case"HS256":case"HS384":case"HS512":t={name:"HMAC",hash:{name:"SHA-".concat(e.alg.substr(-3))}},r=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new H("".concat(e.alg," keys cannot be imported as CryptoKey instances"));case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":t={name:"AES-GCM"},r=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":t={name:"AES-KW"},r=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":t={name:"PBKDF2"},r=["deriveBits"];break;default:throw new H('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:{name:"SHA-".concat(e.alg.substr(-3))}},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-".concat(e.alg.substr(-3))}},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:{name:"SHA-".concat(parseInt(e.alg.substr(-3),10)||1)}},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new H('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":case"ES384":case"ES512":t={name:"ECDSA",namedCurve:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new H('unsupported or invalid JWK "alg" (Algorithm) Parameter value')}break;default:throw new H('unsupported or invalid JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}var qe,ze,Fe,Ve,Xe=function(){var e=y(w.mark((function e(t){var r,n,i,o,a,c,s;return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Ge(t),o=i.algorithm,a=i.keyUsages,c="jwk",delete(s=Qe({},t)).alg,"PBKDF2"===o.name&&(c="raw",s=F(t.k)),e.abrupt("return",V.subtle.importKey(c,s,o,null!==(r=t.ext)&&void 0!==r&&r,null!==(n=t.key_ops)&&void 0!==n?n:a));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Ye(t){if("object"!==e(r=t)||null===r||"[object Object]"!==Object.prototype.toString.call(t))return!1;var r;if(null===Object.getPrototypeOf(t))return!0;for(var n=t;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(t)===n}function $e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function et(e,t,r){return tt.apply(this,arguments)}function tt(){return(tt=y(w.mark((function e(t,r,n){return w.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ye(t)){e.next=2;break}throw new TypeError("JWK must be an object");case 2:if(r||(r=t.alg),"string"==typeof r&&r){e.next=5;break}throw new TypeError('"alg" argument is required when "jwk.alg" is not present');case 5:e.t0=t.kty,e.next="oct"===e.t0?8:"RSA"===e.t0?14:"EC"===e.t0||"OKP"===e.t0?16:17;break;case 8:if("string"==typeof t.k&&t.k){e.next=10;break}throw new TypeError('missing "k" (Key Value) Parameter value');case 10:if(null!=n||(n=!0!==t.ext),!n){e.next=13;break}return e.abrupt("return",Xe(Ze(Ze({},t),{},{alg:r,ext:!1})));case 13:return e.abrupt("return",F(t.k));case 14:if(void 0===t.oth){e.next=16;break}throw new H('RSA JWK "oth" (Other Primes Info) Parameter value is unsupported');case 16:return e.abrupt("return",Xe(Ze(Ze({},t),{},{alg:r})));case 17:throw new H('unsupported "kty" (Key Type) Parameter value');case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e){var t=[];return e.forEach((function(e){var r=function(e){switch(e){case"phone":return d.Phone;case"email":return d.Email;default:return null}}(e);null!==r&&t.push(r)})),t}function nt(e){var t=[];return e.forEach((function(e){t.push(function(e){switch(e){case f.OpenId:return"openid";case f.Phone:return"phone";case f.NetworkInfo:return"bindid_network_info";case f.Email:return"email"}}(e))})),t}function it(e){var t,r=[];return null===(t=e)||void 0===t||t.forEach((function(e){var t=function(e){switch(e){case"openid":return f.OpenId;case"phone":return f.Phone;case"bindid_network_info":return f.NetworkInfo;case"email":return f.Email;default:return null}}(e);t&&r.push(t)})),r}!function(e){e.Code="code"}(qe||(qe={})),function(e){e.Page="page"}(ze||(ze={})),function(e){e.Login="login"}(Fe||(Fe={})),function(e){e.email="ts.bindid.iac.email",e.phone="ts.bindid.iac.phone_number"}(Ve||(Ve={}));var ot=new Map;ot.set(d.Email,Ve.email),ot.set(d.Phone,Ve.phone);var at="https://signin.bindid-sandbox.io";function ct(e){return"string"==typeof e?e.split(/(?=[A-Z])/).join("_").toLowerCase():""}function st(e){var t=window.location.search.match(new RegExp("[?&]"+e+"=([^&#]*)"));return t&&t[1]}var ut,lt=function(){function t(e,t){void 0===e&&(e=at),void 0===t&&(t="/authorize"),this.url=e,this.authenticatePath=t}return t.prototype.setRequestParams=function(e){return this.params=e,this},t.prototype.setConfig=function(e){return this.config=e,this},t.prototype.buildUrl=function(e){return[""+this.url+this.authenticatePath,e].join("?")},t.prototype.buildForAuthentication=function(){return this.preparedQueryParams=this.authenticationRequestQueryParams,this},t.prototype.buildForTransaction=function(){return this.preparedQueryParams=this.transactionRequestQueryParams,this},t.prototype.asUrlString=function(){return this.preparedQueryParams?this.buildUrl(this.createQueryString(this.preparedQueryParams)):""},t.prototype.createJWERequestQueryValue=function(e,t){return c(this,void 0,void 0,(function(){var r,n,i,o,a;return s(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),[4,et(t)];case 1:return r=c.sent(),n=JSON.stringify(this.preparedQueryParams),i=new TextEncoder,[4,new Le(i.encode(n)).setProtectedHeader(e).encrypt(r)];case 2:return o=c.sent(),[2,Promise.resolve(o)];case 3:return a=c.sent(),console.log("createJWERequestQueryValue rejected with error: "+JSON.stringify(a)),[2,Promise.reject(a)];case 4:return[2]}}))}))},t.prototype.createJWEQueries=function(e){return{client_id:this.preparedQueryParams.client_id,response_type:this.preparedQueryParams.response_type,redirect_uri:this.preparedQueryParams.redirect_uri,request:e}},t.prototype.asJWERequestUrlString=function(e,t){return c(this,void 0,void 0,(function(){var r,n,i;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.createJWERequestQueryValue(e,t)];case 1:return r=o.sent(),n=this.createJWEQueries(r),[2,Promise.resolve(this.buildUrl(this.createQueryString(n)))];case 2:return i=o.sent(),console.log("asJWERequestUrlString rejected with error: "+JSON.stringify(i)),[2,Promise.reject(i)];case 3:return[2]}}))}))},Object.defineProperty(t.prototype,"presetQueryParams",{get:function(){return{scope:this.oidcListQueryParamScopes(this.scopesList),display:ze.Page,prompt:Fe.Login,response_type:qe.Code}},enumerable:!0,configurable:!0}),t.prototype.oidcListQueryParamScopes=function(e){return nt(e).join(" ")},t.prototype.oidcListQueryParam=function(e){return e.join(" ")},Object.defineProperty(t.prototype,"scopesList",{get:function(){var e,t=(null===(e=this.params)||void 0===e?void 0:e.scope)||[];return-1==t.indexOf(f.OpenId)?function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,c=o.length;a<c;a++,i++)n[i]=o[a];return n}(t,[f.OpenId]):t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authenticationRequestQueryParams",{get:function(){return a(a(a({},this.configQueryParams),this.requestQueryParams),this.presetQueryParams)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transactionRequestQueryParams",{get:function(){return a(a({},this.authenticationRequestQueryParams),this.claimsQueryParams)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"claimsQueryParams",{get:function(){return{claims:this.requestClaimsObject}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestClaimsObject",{get:function(){var e=this.params.transactionSigningData,t={id_token:{bindid_psd2_transaction:{essential:e.essential||!0,value:{display_data:{payee:e.displayData.payee,payment_amount:e.displayData.paymentAmount,payment_method:e.displayData.paymentMethod}}}}};return e.additionalData&&(t.id_token.bindid_psd2_transaction.value.additional_data=e.additionalData),t},enumerable:!0,configurable:!0}),t.prototype.createQueryString=function(e){var t=this;return Object.keys(e).reduce((function(r,n){var i=t.stringifyQueryStringValue(e[n]);if(i){var o=[n,encodeURIComponent(i)].join("=");return r.concat(o)}return r}),[]).join("&")},t.prototype.stringifyQueryStringValue=function(t){switch(e(t)){case"string":return t;case"number":return t.toString(10);case"boolean":return t?"true":"false";case"object":return JSON.stringify(t);default:return null}},Object.defineProperty(t.prototype,"configQueryParams",{get:function(){return{client_id:this.config.clientId}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"requestQueryParams",{get:function(){var e,t,r,n,i=this.params,o={redirect_uri:i.redirectUri,nonce:null===(e=i)||void 0===e?void 0:e.nonce,state:null===(t=i)||void 0===t?void 0:t.state,acr_values:this.acrValues},c={bindid_aux_link_title:null===(r=this.params.otherLoginOptions)||void 0===r?void 0:r.title,bindid_aux_link:null===(n=this.params.otherLoginOptions)||void 0===n?void 0:n.url},s=this.params.customMessage?{bindid_custom_message:this.params.customMessage}:{};return a(a(a({},o),c),s)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"acrValues",{get:function(){var e=[];return e=e.concat(this.dataVerificationAcrs),this.oidcListQueryParam(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataVerificationAcrs",{get:function(){var e;return((null===(e=this.params.verifications)||void 0===e?void 0:e.map((function(e){return ot.get(e)})))||[]).filter((function(e,t,r){return e&&r.indexOf(e)===t}))},enumerable:!0,configurable:!0}),t}();!function(e){e[e.Authentication=0]="Authentication",e[e.Transaction=1]="Transaction"}(ut||(ut={}));var pt,ft=function(){function e(){this.XmBindIdErrorCode=l,this.XmBindIdApiCompatibilityLevel=p,this.XmBindIdScopeType=f,this.XmRequiredVerifications=d}return e.createBindIdSdkError=function(e,t,r){return{code:e,message:t,errorUri:r||null}},e.prototype.fetchResource=function(e){return new Promise((function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.setRequestHeader("Content-Type","text/html"),n.setRequestHeader("Access-Control-Allow-Origin","*"),n.onload=function(){n.status>=200&&n.status<300?t(n.response):r(n.response)},n.onerror=function(){return r(n.response)},n.send()}))},e.prototype.saveJoseHeader=function(e){var t,r,n,i,o=JSON.parse(e);this.joseHeader={alg:null===(r=null===(t=o)||void 0===t?void 0:t.request_object_encryption_alg_values_supported)||void 0===r?void 0:r[0],enc:null===(i=null===(n=o)||void 0===n?void 0:n.request_object_encryption_enc_values_supported)||void 0===i?void 0:i[0]}},e.prototype.saveJWK=function(e){var t=JSON.parse(e);if(t.keys)for(var r=0,n=t.keys;r<n.length;r++){var i=n[r];if(this.isJWKSSignature(i))return void(this.jwk=i)}},e.prototype.isJWKSSignature=function(e){if(!e.kid)return!1;var t=JSON.parse(e.kid.replace("\\",""));return"enc"===e.use&&"auto-generated_bindid"===t.version},e.prototype.fetchJWK=function(e){var t=this;return this.fetchResource(e).then((function(e){try{return t.saveJWK(e),Promise.resolve(!0)}catch(e){return console.log("fetchJWK rejected with error: "+JSON.stringify(e)),Promise.reject(e)}})).catch((function(e){return console.log("fetchJWK rejected with error: "+JSON.stringify(e)),Promise.reject(e)}))},e.prototype.fetchJoseHeader=function(e){var t=this;return this.fetchResource(e).then((function(e){try{return t.saveJoseHeader(e),Promise.resolve(!0)}catch(e){return console.log("fetchJoseHeader rejected with error: "+JSON.stringify(e)),Promise.reject(e)}})).catch((function(e){return console.log("fetchJoseHeader rejected with error: "+JSON.stringify(e)),Promise.reject(e)}))},e.prototype.initialize=function(e){return this.config=e,this.verifyConfig()},e.prototype.verifyConfig=function(){var t=this;return new Promise((function(r,n){var i;(null===(i=t)||void 0===i?void 0:i.config)?(t.config.apiCompat||(t.config.apiCompat=p.UseLatest),t.initialized=!0,r(!0)):n(e.createBindIdSdkError(l.InvalidConfig,"BindId SDK config Error - Config wasn't provided"))}))},e.prototype.saveState=function(e){e&&localStorage.setItem("XM_BIND_ID_STATE_KEY",e)},e.prototype.validateState=function(e){var t;if(null===(t=this.config)||void 0===t?void 0:t.disableStateValidation)return!0;var r=localStorage.getItem("XM_BIND_ID_STATE_KEY");return e&&r&&r===e},e.prototype.processRedirectResponse=function(){var t=this,r=window.XmBindId;return r&&!this.initialized?r.initialize(mt()).then((function(r){return r?t.internalProcessRedirectResponse():Promise.reject(e.createBindIdSdkError(l.SdkNotInitialized,"BindId SDK could not be initialized"))})):r&&this.initialized?this.internalProcessRedirectResponse():Promise.reject(e.createBindIdSdkError(l.SdkNotInitialized,"BindId SDK was not found"))},e.prototype.internalProcessRedirectResponse=function(){var t=this;return new Promise((function(r,n){if(t.initialized){var i=st(ct("state"))||void 0,o=st(ct("code"))||void 0,a=t.validateState(i);if(o)if(a){var c=e.extractErrorFromQuery();c&&n(c),r({code:o,state:i||null})}else n(e.createBindIdSdkError(l.InvalidResponse,"State validation enabled and validation failed to match state"));else n(e.createBindIdSdkError(l.InvalidResponse,"Error : no code returned"))}else n(e.createBindIdSdkError(l.SdkNotInitialized,"BindId SDK was not initialized"))}))},e.extractErrorFromQuery=function(){var t=st("error")||void 0,r=st("error_description")||void 0,n=st("error_uri")||void 0,i=t&&this.errorResponseToCode(t);return i&&r?e.createBindIdSdkError(i,r,n):null},e.errorResponseToCode=function(e){switch(e){case"access_denied":return l.AccessDenied;default:return l.ServerError}},e.prototype.createEncryptedBindIdUrl=function(t){var r;return c(this,void 0,void 0,(function(){var n,i,o;return s(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),this.joseHeader||this.jwk?[3,3]:(r=this.config.overrideUrl,n=null!=r?r:at,[4,this.fetchJoseHeader(n+"/.well-known/openid-configuration")]);case 1:return a.sent(),[4,this.fetchJWK(n+"/jwks")];case 2:a.sent(),a.label=3;case 3:return[4,t.asJWERequestUrlString(this.joseHeader,this.jwk)];case 4:return i=a.sent(),[2,Promise.resolve(i)];case 5:return o=a.sent(),console.log("createEncryptedBindIdUrl rejected with error: "+JSON.stringify(o)),[2,Promise.reject(e.createBindIdSdkError(l.InvalidConfig,"failed to create url: "+JSON.stringify(o)))];case 6:return[2]}}))}))},e.prototype.invokeBindIdRequest=function(t,r){var n=this;return new Promise((function(i,o){return c(n,void 0,void 0,(function(){var n,i,a,c,u,p;return s(this,(function(s){switch(s.label){case 0:return this.initialized?((null===(c=this.config)||void 0===c?void 0:c.disableStateValidation)||(r.state=(null===(u=r)||void 0===u?void 0:u.state)||(f=[].slice.call(window.crypto.getRandomValues(new Uint8Array(10))),window.btoa(String.fromCharCode.apply(null,f)).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,""))),this.saveState(null===(p=r)||void 0===p?void 0:p.state),n=this.buildForRequestType(t,this.createBindIdUrlBuilder(r)),i="",r.encrypted?[3,1]:(i=n.asUrlString(),[3,4])):[3,5];case 1:return s.trys.push([1,3,,4]),[4,this.createEncryptedBindIdUrl(n)];case 2:return i=s.sent(),[3,4];case 3:return a=s.sent(),o(a),[3,4];case 4:return window.location.href=i,[3,6];case 5:o(e.createBindIdSdkError(l.SdkNotInitialized,"BindId SDK was not initialized")),s.label=6;case 6:return[2]}var f}))}))}))},e.prototype.createBindIdUrlBuilder=function(e){return new lt(this.config.overrideUrl,this.config.overridePath).setConfig(this.config).setRequestParams(e)},e.prototype.buildForRequestType=function(e,t){switch(e){case ut.Authentication:return t.buildForAuthentication();case ut.Transaction:return t.buildForTransaction()}},e.prototype.authenticate=function(e){return c(this,void 0,void 0,(function(){return s(this,(function(t){return null!=e.encrypted&&null!=e.encrypted||(e.encrypted=!1),[2,this.invokeBindIdRequest(ut.Authentication,e)]}))}))},e.prototype.signTransaction=function(e){return c(this,void 0,void 0,(function(){alert ('---IN BIND----');return s(this,(function(t){return null!=e.encrypted&&null!=e.encrypted||(e.encrypted=!0),[2,this.invokeBindIdRequest(ut.Transaction,e)]}))}))},e}();function dt(e,t){if(e)try{var r=window[e];r&&r.call(t)}catch(e){console.log("ERROR "+e)}}function ht(e){var t=window.XmBindId,r=e.getAttribute("data-xm-bind-id-on-failure"),n=e.getAttribute("data-xm-bind-id-on-success");t&&t.initialize(mt()).then((function(e){if(e)return t.authenticate(function(){var e,t,r=bt("aux_link"),n=bt("aux_link_title"),i=null;n&&r&&(i={title:n,url:r});var o=(null===(e=bt("scope"))||void 0===e?void 0:e.split(" "))||[],a=(null===(t=bt("verifications"))||void 0===t?void 0:t.split(" "))||[];return{scope:it(o),nonce:bt("nonce")||null,redirectUri:yt("redirectUri"),state:bt("state")||null,verifications:rt(a),customMessage:bt(vt("customMessage"))||null,otherLoginOptions:i,encrypted:!1}}()).then((function(e){dt(n,e)}),(function(e){dt(r,e)}));throw{code:l.InvalidResponse,message:"SDK initialization error"}}))}function yt(e){var t=bt(vt(e));if(null==t)throw"Missing mandatory '"+e+"' meta tag";return t}function vt(e){return ct(e)}function bt(e){var t;return null===(t=document.querySelector('meta[name="xm-bind-id-'+e+'"]'))||void 0===t?void 0:t.content}function mt(){var e,t={clientId:yt("clientId"),apiCompat:function(e){switch(e){case"api-level-1":return p.ApiLevel1;case"latest":return p.UseLatest;default:return null}}(bt("api_compat"))||p.UseLatest,disableStateValidation:!1},r=bt("internal-override_url");return(null===(e=r)||void 0===e?void 0:e.length)&&(t.overrideUrl=r),t}function wt(){var e=Array.prototype.slice.call(document.getElementsByClassName("xm-bind-id-button"));e&&e.forEach((function(e){e.addEventListener("click",(function(){ht(e)}))}))}window.XmBindId=new ft,wt(),pt=wt,new window.MutationObserver((function(e,t){pt()})).observe(document,{childList:!0,subtree:!0})}));